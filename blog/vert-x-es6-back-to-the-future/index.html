<!DOCTYPE html><html lang=en><head><title>Vert.x ES6 back to the future</title><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta content="width=device-width,initial-scale=1" name=viewport><meta content="Vert.x is a tool-kit for building reactive applications on the JVM." name=description><link href=http://vertx.io/stylesheets/main.css media=screen rel=stylesheet><link href=http://vertx.io/stylesheets/font-awesome.min.css media=screen rel=stylesheet><link href=http://vertx.io/javascripts/styles/rainbow.min.css media=screen rel=stylesheet><!--[if lt IE 9]><script src="http://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script><![endif]--><link href=http://vertx.io/assets/favicons/vertx-favicon-5.ico rel="shortcut icon"><link href="http://fonts.googleapis.com/css?family=Ubuntu:400,500,700,400italic" rel=stylesheet type=text/css><link rel=alternate type=application/rss+xml title=RSS href=http://vertx.io/feed.xml><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-30144458-1', 'auto');
    ga('create', 'UA-71153120-1', 'auto', 'tracker');
    ga('send', 'pageview');
    ga('tracker.send', 'pageview');</script></head><body><a href="http://www.reactivemanifesto.org/" id=reactive-manifesto-banner><img style="border: 0; position: fixed; right: 0; top:0; z-index: 9000" src=http://d379ifj7s9wntv.cloudfront.net/reactivemanifesto/images/ribbons/we-are-reactive-black-right.png></a> <a id=skippy class="sr-only sr-only-focusable" href=#content><div class=container><span class=skiplink-text>Skip to main content</span></div></a><header class="navbar navbar-default navbar-static-top" id=top role=banner><div class=container><div class=navbar-header><button class="navbar-toggle collapsed" type=button data-toggle=collapse data-target=#vertx-navbar-collapse><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="http://vertx.io/" class=navbar-brand><img alt=Brand src=http://vertx.io/assets/logo-sm.png></a></div><nav class="collapse navbar-collapse" id=vertx-navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=https://bintray.com/vertx/downloads/distribution/3.1.0/view>Download</a></li><li><a href="http://vertx.io/docs/">Documentation</a></li><li><a href=https://github.com/vert-x3/wiki/wiki>Wiki</a></li><li><a href="http://vertx.io/community/">Community</a></li><li><a href="http://vertx.io/blog/">Blog</a></li><li><a href="http://vertx.io/vertx2/" class=vertx-2-link>Vert.x 2</a></li></ul></nav></div></header><div class=container><div class="row blog"><article class="col-xs-12 blog-post"><h2 class=blog-post-title>Vert.x ES6 back to the future</h2><p class=blog-post-meta>25th November 2015 by <a href=http://github.com/pmlopes>pmlopes</a></p><article><p>On <a href=http://backtothefuture.wikia.com/wiki/2015>October 21th, 2015</a> we all rejoiced with the return from the past of Marty McFly with his flying car and so on, however in the Vert.x world we were quite sad that the JavaScript support we have was still using a technology released in <a href=https://en.wikipedia.org/wiki/ECMAScript#Versions>December 2009</a>. The support for ES5 is not something that we Vert.x team controls but something that is inherited from running on top of <a href="http://openjdk.java.net/projects/nashorn/">Nashorn</a>.</p><p>With all these nostalgic thoughts on my mind I’ve decided to bring us back to the future and by future I mean, lets start using a modern JavaScript, or more correctly, lets start using <a href="http://es6-features.org/">ECMAScript 6</a>.</p><p>It turned out to be quite simple to achieve this so I’ll pick the hello world example and write it in ES6 just to show how you can port your code to ES6 and still use the current Vert.x APIs. Note that Vert.x internals still are ES5 and have not been touched or modified to support any of ES6 features.</p><h2 id=main>main</h2><p>Traditionally your <code>main.js</code> file would reside in the root of your module (this is where <code>NPM</code> will look for it by default); however as we are going to transpile to <code>ES5</code> you’ll want to put your index file in <code>/src/main.js</code>.</p><p>However, because we are transpiling to <code>ES5</code>, your <code>package.json</code>‘s main block should point to the transpiled <code>index.js</code> file in the <code>/lib</code> directory.</p><pre><code class="hljs json">{
  "<span class=hljs-attribute>name</span>": <span class=hljs-value><span class=hljs-string>"vertx-es6"</span></span>,
  "<span class=hljs-attribute>version</span>": <span class=hljs-value><span class=hljs-string>"0.0.1"</span></span>,
  "<span class=hljs-attribute>private</span>": <span class=hljs-value><span class=hljs-literal>true</span></span>,

  "<span class=hljs-attribute>main</span>": <span class=hljs-value><span class=hljs-string>"lib/main.js"</span></span>,

  "<span class=hljs-attribute>scripts</span>": <span class=hljs-value>{
    "<span class=hljs-attribute>build</span>": <span class=hljs-value><span class=hljs-string>"rm -Rf lib &amp;&amp; ./node_modules/.bin/babel --out-dir lib src"</span></span>,
    "<span class=hljs-attribute>start</span>": <span class=hljs-value><span class=hljs-string>"./node_modules/.bin/vertx run lib/main.js"</span>
  </span>}</span>,

  "<span class=hljs-attribute>dependencies</span>": <span class=hljs-value>{
    "<span class=hljs-attribute>vertx3-full</span>": <span class=hljs-value><span class=hljs-string>"3.1.0"</span></span>,
    "<span class=hljs-attribute>babel-cli</span>": <span class=hljs-value><span class=hljs-string>"6.2.0"</span></span>,
    "<span class=hljs-attribute>babel-preset-es2015</span>": <span class=hljs-value><span class=hljs-string>"6.1.18"</span>
  </span>}
</span>}</code></pre><p>As you can see, the main idea is to invoke the transpiler (Babel) when we are building our project, and run it using the generated files. This is slightly equivalent to a compilation process you would have using compiled language.</p><h2 id=-npmignore>.npmignore</h2><p>If you’re planning to deploy your package to npm either local or private you should be aware that npm will exclude anything listed on your <code>.gitignore</code> since we should ignore the generated code from git it need to inform npm to ignore that rule and keep the <code>lib</code> directory. The <code>.gitignore</code> should be something like:</p><pre><code class=hljs>/<span class=hljs-keyword>lib</span>
/node_modules</code></pre><p>And the <code>.npmignore</code>:</p><pre><code class=hljs>/.gitignore</code></pre><h2 id=hello-fat-arrows-and-let-keywords>Hello fat arrows and let keywords</h2><p>So all the heavy work has been done, in order to create our hello world we just need to code some <code>ES6</code> in our <code>src/main.js</code> file:</p><pre><code class="hljs javascript"><span class=hljs-keyword>var</span> Router = <span class=hljs-built_in>require</span>(<span class=hljs-string>"vertx-web-js/router"</span>);
<span class=hljs-keyword>var</span> server = vertx.createHttpServer();

<span class=hljs-keyword>var</span> router = Router.router(vertx);

router.get(<span class=hljs-string>"/"</span>).handler((ctx) =&gt; {

    <span class=hljs-keyword>let</span> response = ctx.response();
    response.putHeader(<span class=hljs-string>"content-type"</span>, <span class=hljs-string>"text/plain"</span>);

    response.end(<span class=hljs-string>"Hello ES6 World!"</span>);
});

server.requestHandler(router.accept).listen(<span class=hljs-number>8080</span>);</code></pre><p>As you can see we’re using fat arrows instead of writing a function closure and scoped variables using <code>let</code> keyword. If you now compile your project:</p><pre><code class=hljs>npm <span class=hljs-command>run</span> build</code></pre><p>And then start it:</p><pre><code class=hljs><span class=hljs-built_in>npm</span> start</code></pre><p>You have your first back to the future <code>ES6</code> verticle!</p></article></article></div><div class=row><div class=col-xs-12 id=disqus_thread></div></div><script type=text/javascript>/* * * CONFIGURATION VARIABLES * * */
  var disqus_shortname = 'vertx';

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div><footer><div class=container><div class=row><div class="col-xs-6 col-sm-3 col-md-3 col-lg-2"><h2>Vert.x</h2><ul class=list-unstyled><li><a href="http://vertx.io/">Home</a></li><li><a href=https://bintray.com/vertx/downloads/distribution/3.1.0/view>Download</a></li><li><a href="http://vertx.io/docs/">Documentation</a></li><li><a href=https://github.com/vert-x3/wiki/wiki>Wiki</a></li><li><a href="http://vertx.io/blog/">Blog</a></li><li><a href="http://vertx.io/vertx2/" class=vertx-2-link>Vert.x 2</a></li></ul></div><div class="col-xs-6 col-sm-3 col-md-3 col-lg-2"><h2>Community</h2><ul class=list-unstyled><li><a href="http://vertx.io/community/">Help &amp; Contributors</a></li><li><a href="http://vertx.io/materials/">Learning materials</a></li><li><a href=https://groups.google.com/forum/?fromgroups#!forum/vertx>User Group</a></li><li><a href=https://groups.google.com/forum/?fromgroups#!forum/vertx-dev>Developer Group</a></li></ul></div><div class="col-xs-12 col-sm-6 col-lg-offset-2 col-md-6 copyright"><p>Vert.x is open source and dual licensed under the <a href=https://www.eclipse.org/org/documents/epl-v10.php>Eclipse Public License 1.0</a> and <a href=https://www.apache.org/licenses/LICENSE-2.0.html>Apache License 2.0</a>.</p><p>This website is licensed under the <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0 License</a>.<br>Design by <a href=http://www.michel-kraemer.com>Michel Kr&auml;mer</a>. <a href=http://www.entypo.com>Entypo pictograms</a> by Daniel Bruce.</p><div class=row><div class="col-xs-12 col-lg-offset-2 col-md-5"><img class="logo eclipse-logo" src=http://vertx.io/assets/eclipse_logo_grey_small.png width=204 height=48></div><div class="col-xs-12 col-md-offset-2 col-lg-offset-0 col-md-5"><img class="logo cloudbees-logo" src=http://vertx.io/assets/Button-Built-on-CB-1-grey.png width=184 height=48></div></div></div></div></div></footer><script src=http://static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js></script><script src=http://vertx.io/javascripts/bootstrap.min.js></script><script src=http://vertx.io/javascripts/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>